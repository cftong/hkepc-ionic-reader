<ion-view ng-init="vm.messages=[]" >
  <ion-nav-title>
    <p>
      <button class="button button-icon icon ion-navicon" ng-click="openPopover($event)"> 第 {{vm.page}} 頁</button>
    </p>
    <script id="my-popover.html" type="text/ng-template">
      <ion-popover-view>
        <ion-header-bar>
          <h1 class="title">第 {{vm.inputPage}} 頁</h1>
        </ion-header-bar>
        <ion-content >
          <div class="list">
            <div class="item range range-positive">
              <input type="range"  min="1" max="{{vm.totalPageNum}}" value="{{vm.page}}"  step="1" ng-init="vm.inputPage = 1" ng-model="vm.inputPage" ng-change="vm.onPageSliderDrag(vm.inputPage)">
            </div>
          </div>
          <div class="padding">
            <a class="button button-full button-balanced"
               ng-click="closePopover()"
               href="#/tab/topics/{{vm.topicId}}/posts/{{vm.postId}}/page/{{vm.inputPage}}">
              前住
            </a>
            <button class="button button-full button-assertive" ng-click="closePopover()">
              取消
            </button>
          </div>

        </ion-content>
      </ion-popover-view>
    </script>
  </ion-nav-title>
  <ion-nav-buttons side="right" style="float:right">
    <a class="button button-icon icon ion-refresh" ng-click="vm.doRefresh()"></a>
  </ion-nav-buttons>
  <ion-content class="padding" on-swipe-right="vm.onSwipeRight()"  style="background-color:#f5f5f5">
    <div style="text-align:center">
      <h4 class="title" >{{vm.post.title || '下載中'}}</h4>
    </div>
    <div class="spinner">
      <ion-spinner class="spinner-balanced" icon="ripple" ng-show="vm.messages.length == 0"></ion-spinner>
    </div>
    <div class="list card" ng-repeat="message in vm.messages track by $index">

      <div class="item item-avatar">
        <img src="{{::message.author.image}}">
        <h2 ng-bind="::message.author.name"></h2>
        <p>{{::message.createdAt}} <span style="float:right">#{{::message.pos}}</span></p>
      </div>

      <div class="item item-body" ng-bind-html="::message.content">
      </div>

      <div class="item tabs tabs-secondary tabs-icon-left">
        <a class="tab-item" ng-click="vm.like(message)">
          <i class="icon ion-thumbsup" ng-style="message.likedStyle"></i>
          Like
        </a>
        <a class="tab-item" ng-click="vm.onReply(message)" >
          <i class="icon ion-chatbox"></i>
          Comment
        </a>
        <a class="tab-item" >
          <i class="icon ion-share"></i>
          Share
        </a>
      </div>

    </div>
    <ion-infinite-scroll
        class="ispinner"
        ng-if="vm.hasMoreData()"
        style="text-align: center;"
        on-infinite="vm.loadMore()"
        spinner="ripple"
        immediate-check="false"
        distance="7%">
    </ion-infinite-scroll>
    <div style="text-align:center" ng-show="vm.end">
      <h4 class="title">完</h4>
    </div>
  </ion-content>
</ion-view>

